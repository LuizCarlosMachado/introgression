# Introgression Detection Pipeline using ARGweaverD

## Overview
This pipeline processes ARG inference results to identify introgressed regions based on inferred migration events. The pipeline consists of two main scripts:

1. **`1.generate_hapmig.py`** - Generates the haplotype migration file (`hapmig.txt`).
2. **`2.summarie_ARG.sh`** - Converts ARGs to BED format and summarizes migration events.

## Input Files

### **1. `mig_file.txt`**
This file defines migration events for summarization.

**Example:**
```
B2A_mig  1  0  1129.5
```
- **B2A_mig**: Name of the migration event.
- **1**: Recipient population.
- **0**: Source population.
- **1129.5**: Time in generations.

### **2. `intro_tracts_sim_SP_B2A_1mb_hapmig.txt`**
This file lists migrating haplotypes for individualized statistics, generated automatically by `1.generate_hapmig.py`.

**Example:**
```
B2A_mig_A_1_2   1       0       1000    A_1_2
B2A_mig_B_1_1   1       0       1000    B_1_1
B2A_mig_C_0_2   1       0       1000    C_0_2
B2A_mig_A_2_2   1       0       1000    A_2_2
```

## How to Use the Scripts

### **Step 1: Generate the HapMig File**
Run the first script to create the haplotype migration file:
```
python 1.generate_hapmig.py
```
This will generate `intro_tracts_sim_SP_B2A_1mb_hapmig.txt` in the `outputs/` folder.

### **Step 2: Summarize Migration Events**
Run the second script to process the ARG and extract migration statistics.

#### **Without specifying a genomic region (whole chromosome analysis):**
```
bash 2.summarie_ARG.sh intro_tracts_sim_SP_B2A_1mb outputs/intro_tracts_sim_SP_B2A_1mb_hapmig.txt outputs/summary
```

#### **With a specific genomic region:**
```
bash 2.summarie_ARG.sh intro_tracts_sim_SP_B2A_1mb outputs/intro_tracts_sim_SP_B2A_1mb_hapmig.txt outputs/summary 1 50 999889
```
- **1** → Chromosome.
- **50** → Start position.
- **999889** → End position.

## Output Files and Their Meaning

1️⃣ **`outputs/intro_tracts_sim_SP_B2A_1mb.bed.gz`**  
   - **Description**: Compressed BED file containing inferred local trees from the ARG.  
   - **Generated by**: `smc2bed-all`.  
   - **Usage**: Used as input for `arg-summarize` to compute ARG statistics along the chromosome.

2️⃣ **`outputs/intro_tracts_sim_SP_B2A_1mb.log`**  
   - **Description**: Log file for `arg-summarize`, recording details of the analysis and any errors.  
   - **Generated by**: `arg-summarize`.  
   - **Usage**: Useful for debugging and tracking execution details.

3️⃣ **`outputs/summary.migStatsHap.bed.gz`**  
   - **Description**: Summarized migration statistics for the entire chromosome.  
   - **Generated by**: `arg-summarize` without region filtering.  
   - **Usage**: Contains detected migration events along the whole chromosome.

4️⃣ **`outputs/summary.migStatsHap_region.bed.gz`** *(Only if CHR, WINSTART, WINEND are provided)*  
   - **Description**: Summarized migration statistics **filtered for a specific genomic region**.  
   - **Generated by**: `arg-summarize` with `-r CHR:WINSTART-WINEND`.  
   - **Usage**: Enables focused analysis of introgression within a specific region.

5️⃣ **`outputs/summary_pipeline.log`**  
   - **Description**: General pipeline log file, containing all execution steps and error messages.  
   - **Generated by**: The script using `tee -a`.  
   - **Usage**: Helps track execution progress, runtime, and potential issues.

## Summary
This guide explains how to use the scripts in the repository to process ARGs, detect introgression, and summarize migration events. The outputs include migration statistics for both whole-genome and specific regions. This pipeline ensures a structured and automated workflow for analyzing introgression using ARGweaverD.


